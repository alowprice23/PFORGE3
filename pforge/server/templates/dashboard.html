{% extends "base.html" %}

{% block title %}pForge Dashboard{% endblock %}

{% block head %}
    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
{% endblock %}

{% block content %}
<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
    <!-- Efficiency Gauge -->
    <div class="bg-white p-4 rounded-lg shadow">
        <h2 class="text-gray-500 text-sm font-medium">Efficiency (E)</h2>
        <p id="efficiency" class="text-3xl font-bold">0.00</p>
    </div>
    <!-- Entropy Gauge -->
    <div class="bg-white p-4 rounded-lg shadow">
        <h2 class="text-gray-500 text-sm font-medium">Entropy (H)</h2>
        <p id="entropy" class="text-3xl font-bold">0.00</p>
    </div>
    <!-- Gaps Gauge -->
    <div class="bg-white p-4 rounded-lg shadow">
        <h2 class="text-gray-500 text-sm font-medium">Gaps</h2>
        <p id="gaps" class="text-3xl font-bold">0</p>
    </div>
    <!-- Misfits Gauge -->
    <div class="bg-white p-4 rounded-lg shadow">
        <h2 class="text-gray-500 text-sm font-medium">Misfits</h2>
        <p id="misfits" class="text-3xl font-bold">0</p>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', (event) => {
        const socket = io("/ws");

        socket.on('EFF.UPDATED', (data) => {
            const metrics = data.proof.metrics;
            document.getElementById('efficiency').textContent = metrics.E.toFixed(2);
            document.getElementById('entropy').textContent = metrics.H.toFixed(2);
            // Assuming gaps and misfits are also in the metrics payload
            if (metrics.gaps) {
                document.getElementById('gaps').textContent = metrics.gaps;
            }
            if (metrics.misfits) {
                document.getElementById('misfits').textContent = metrics.misfits;
            }
        });
    });
</script>
{% endblock %}
